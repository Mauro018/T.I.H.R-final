<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %} {% endblock %} | ¡Oferta Exclusiva!</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'core/css/styles.css' %}">
    <style>
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: #000;
        }
        
        .modal-header {
            padding-bottom: 10px;
            border-bottom: 2px solid #007BFF;
            margin-bottom: 20px;
        }
        
        .modal-body {
            padding: 20px 0;
        }
        
        .modal-product-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .modal-product-info {
            margin: 15px 0;
        }
        
        .modal-product-info h3 {
            color: #007BFF;
            margin-bottom: 10px;
        }
        
        .modal-product-info p {
            margin: 8px 0;
            line-height: 1.6;
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .quantity-selector button {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 18px;
        }
        
        .quantity-selector button:hover {
            background-color: #0056b3;
        }
        
        .quantity-selector input {
            width: 60px;
            text-align: center;
            font-size: 16px;
            padding: 8px;
            border: 2px solid #007BFF;
            border-radius: 5px;
        }
        
        .modal-footer {
            text-align: center;
            margin-top: 20px;
        }
        
        .btn-comprar {
            background-color: #28a745;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        
        .btn-comprar:hover {
            background-color: #218838;
        }
        
        .btn-ver-detalles {
            background-color: #007BFF;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            display: inline-block;
            text-decoration: none;
        }
        
        .btn-ver-detalles:hover {
            background-color: #0056b3;
        }
        
        .precio-destacado {
            font-size: 24px;
            color: #28a745;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
<!-- BARRA LATERAL (MENÚ + FILTROS) -->
<div class="sidebar">
    <div class="sidebar-user-info">
        <a href="{% url 'perfilUsuario' %}" class="user-avatar-link">
            {% if usuario.foto_perfil %}
                <img src="{{ usuario.foto_perfil.url }}" alt="Foto de perfil" width="50" height="50" style="border-radius: 50%; border: 2px solid #007BFF; object-fit: cover;">
            {% else %}
                <img src="{% static 'core/img/Perfil.png' %}" alt="Logo" width="50" height="50" style="border-radius: 50%; border: 2px solid #007BFF;">
            {% endif %}
        </a>
        <span class="username-display">{{ usuario.usernameCliente }}</span>
    </div>
  <h2 class="h2-side">Menú</h2>
  <ul>
    <li><a href="{% url 'home3' %}">Gangazos</a></li>
    <li><a href="{% url 'idea' %}">Crear Idea</a></li>
    <li><a href="{% url 'productos' %}">Ofertas</a></li>
    <li><a href="{% url 'carrito' %}">Carrito</a></li>
    <li><a href="{% url 'contact' %}">Contáctenos</a></li>
    <li><a href="{% url 'comentarios' %}">Comentarios</a></li>
    <li><a href="{% url 'logout' %}" class="logout-button">Cerrar Sesión</a></li>
  </ul>

  <!-- FILTROS -->
  <div class="filtros">
    <h3>Filtrar productos</h3>

    <h2 for="categoria" class="h2-side">Categoría:</h2>
    <select id="categoria">
        <option value="">Elegir Categoria</option> 
        <option value="carpinteria">Armarios</option>
        <option value="marroquineria">Escritorios</option>
        <option value="vidrieria">Sillas</option>
        <option value="metaleria">Cajoneras</option>
        <option value="ceramica">Mesas</option>
        <option value="tapiceria">Utensilios</option>
    </select>

    <button onclick="aplicarFiltros()">Aplicar filtros</button>
  </div>
</div>

<!-- CONTENIDO PRINCIPAL -->
<div class="main-content-wrapper">
  <header>
    <h1 class="div" style="text-align: center;">
      <img src="{% static 'core/img/Gemini_Generated_Image_tzay6utzay6utzay.jfif' %}" alt="Logo" width="75" height="75">
      Tu Idea Hecha Realidad
    </h1>
  </header>

    <section>
        <div>
            <h2>CARPINTERIA</h2>
            <br>
        </div>
        
        <!-- Mesas -->
        <section class="seccion-at">
            <div>
                <h3>Mesas</h3>
                <div>
                    <div class="contenedor-articulos" id="contenedorArticulos">
                        {% for mesa in mesas %}
                        <div class="articulo">
                            <div>
                                <div>
                                    <div class="contenido-articulo">
                                        <p><b>{{ mesa.nombre1 }}</b></p>
                                        <p>{{ mesa.descripcion1|truncatewords:15 }}</p>
                                    </div>
                                </div>
                            </div>
                            {% if mesa.imagen1 %}
                            <img src="{{ mesa.imagen1.url }}" alt="{{ mesa.nombre1 }}">
                            {% else %}
                            <img src="{% static 'core/img/Mesa.jpg' %}" alt="{{ mesa.nombre1 }}">
                            {% endif %}
                            <div class="contenido-articulo">
                                <p class="precio-destacado">${{ mesa.precio1 }}</p>
                                <button class="btn-ver-detalles" onclick="mostrarDetalles('mesa', {{ mesa.id }}, '{{ mesa.nombre1|escapejs }}', '{{ mesa.descripcion1|escapejs }}', '{{ mesa.precio1 }}', '{% if mesa.imagen1 %}{{ mesa.imagen1.url }}{% else %}{% static 'core/img/Mesa.jpg' %}{% endif %}')">Ver Detalles y Comprar</button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="articulo">
                            <div class="contenido-articulo">
                                <p>No hay productos disponibles</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button><a href="{% url 'ceramica' %}">Conocer más</a></button>
                </div>
            </div>
        </section>
        <br>
        <br>
        
        <!-- Sillas -->
        <section class="seccion-at">
            <div>
                <h3>Sillas</h3>
                <div>
                    <div class="contenedor-articulos" id="contenedorArticulos">
                        {% for silla in sillas %}
                        <div class="articulo">
                            <div>
                                <div>
                                    <div class="contenido-articulo">
                                        <p><b>{{ silla.nombre2 }}</b></p>
                                        <p>{{ silla.descripcion2|truncatewords:15 }}</p>
                                    </div>
                                </div>
                            </div>
                            {% if silla.imagen2 %}
                            <img src="{{ silla.imagen2.url }}" alt="{{ silla.nombre2 }}">
                            {% else %}
                            <img src="{% static 'core/img/Sillas.jpg' %}" alt="{{ silla.nombre2 }}">
                            {% endif %}
                            <div class="contenido-articulo">
                                <p class="precio-destacado">${{ silla.precio2 }}</p>
                                <button class="btn-ver-detalles" onclick="mostrarDetalles('silla', {{ silla.id }}, '{{ silla.nombre2|escapejs }}', '{{ silla.descripcion2|escapejs }}', '{{ silla.precio2 }}', '{% if silla.imagen2 %}{{ silla.imagen2.url }}{% else %}{% static 'core/img/Sillas.jpg' %}{% endif %}')">Ver Detalles y Comprar</button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="articulo">
                            <div class="contenido-articulo">
                                <p>No hay productos disponibles</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button><a href="{% url 'vidrieria' %}">Conocer más</a></button>
                </div>
            </div>
        </section>
        <br>
        <br>
        
        <!-- Armarios -->
        <section class="seccion-at">
            <div>
                <h3>Armarios</h3>
                <div>
                    <div class="contenedor-articulos" id="contenedorArticulos">
                        {% for armario in armarios %}
                        <div class="articulo">
                            <div>
                                <div>
                                    <div class="contenido-articulo">
                                        <p><b>{{ armario.nombre3 }}</b></p>
                                        <p>{{ armario.descripcion3|truncatewords:15 }}</p>
                                    </div>
                                </div>
                            </div>
                            {% if armario.imagen3 %}
                            <img src="{{ armario.imagen3.url }}" alt="{{ armario.nombre3 }}">
                            {% else %}
                            <img src="{% static 'core/img/Armario.jpg' %}" alt="{{ armario.nombre3 }}">
                            {% endif %}
                            <div class="contenido-articulo">
                                <p class="precio-destacado">${{ armario.precio3 }}</p>
                                <button class="btn-ver-detalles" onclick="mostrarDetalles('armario', {{ armario.id }}, '{{ armario.nombre3|escapejs }}', '{{ armario.descripcion3|escapejs }}', '{{ armario.precio3 }}', '{% if armario.imagen3 %}{{ armario.imagen3.url }}{% else %}{% static 'core/img/Armario.jpg' %}{% endif %}')">Ver Detalles y Comprar</button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="articulo">
                            <div class="contenido-articulo">
                                <p>No hay productos disponibles</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button><a href="{% url 'carpinteria' %}">Conocer más</a></button>
                </div>
            </div>
        </section>
        <br>
        <br>
        
        <!-- Cajoneras -->
        <section class="seccion-at">
            <div>
                <h3>Cajoneras</h3>
                <div>
                    <div class="contenedor-articulos" id="contenedorArticulos">
                        {% for cajonera in cajoneras %}
                        <div class="articulo">
                            <div>
                                <div>
                                    <div class="contenido-articulo">
                                        <p><b>{{ cajonera.nombre4 }}</b></p>
                                        <p>{{ cajonera.descripcion4|truncatewords:15 }}</p>
                                    </div>
                                </div>
                            </div>
                            {% if cajonera.imagen4 %}
                            <img src="{{ cajonera.imagen4.url }}" alt="{{ cajonera.nombre4 }}">
                            {% else %}
                            <img src="{% static 'core/img/Cajonera1.webp' %}" alt="{{ cajonera.nombre4 }}">
                            {% endif %}
                            <div class="contenido-articulo">
                                <p class="precio-destacado">${{ cajonera.precio4 }}</p>
                                <button class="btn-ver-detalles" onclick="mostrarDetalles('cajonera', {{ cajonera.id }}, '{{ cajonera.nombre4|escapejs }}', '{{ cajonera.descripcion4|escapejs }}', '{{ cajonera.precio4 }}', '{% if cajonera.imagen4 %}{{ cajonera.imagen4.url }}{% else %}{% static 'core/img/Cajonera1.webp' %}{% endif %}')">Ver Detalles y Comprar</button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="articulo">
                            <div class="contenido-articulo">
                                <p>No hay productos disponibles</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button><a href="{% url 'metaleria' %}">Conocer más</a></button>
                </div>
            </div>
        </section>
        <br>
        <br>
        
        <!-- Escritorios -->
        <section class="seccion-at">
            <div>
                <h3>Escritorios</h3>
                <div>
                    <div class="contenedor-articulos" id="contenedorArticulos">
                        {% for escritorio in escritorios %}
                        <div class="articulo">
                            <div>
                                <div>
                                    <div class="contenido-articulo">
                                        <p><b>{{ escritorio.nombre5 }}</b></p>
                                        <p>{{ escritorio.descripcion5|truncatewords:15 }}</p>
                                    </div>
                                </div>
                            </div>
                            {% if escritorio.imagen5 %}
                            <img src="{{ escritorio.imagen5.url }}" alt="{{ escritorio.nombre5 }}">
                            {% else %}
                            <img src="{% static 'core/img/Escritorio.jpg' %}" alt="{{ escritorio.nombre5 }}">
                            {% endif %}
                            <div class="contenido-articulo">
                                <p class="precio-destacado">${{ escritorio.precio5 }}</p>
                                <button class="btn-ver-detalles" onclick="mostrarDetalles('escritorio', {{ escritorio.id }}, '{{ escritorio.nombre5|escapejs }}', '{{ escritorio.descripcion5|escapejs }}', '{{ escritorio.precio5 }}', '{% if escritorio.imagen5 %}{{ escritorio.imagen5.url }}{% else %}{% static 'core/img/Escritorio.jpg' %}{% endif %}')">Ver Detalles y Comprar</button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="articulo">
                            <div class="contenido-articulo">
                                <p>No hay productos disponibles</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button><a href="{% url 'marroquineria' %}">Conocer más</a></button>
                </div>
            </div>
        </section>
        <br>
        <br>
        
        <!-- Utensilios -->
        <section class="seccion-at">
            <div>
                <h3>Utensilios</h3>
                <div>
                    <div class="contenedor-articulos" id="contenedorArticulos">
                        {% for utensilio in utensilios %}
                        <div class="articulo">
                            <div>
                                <div>
                                    <div class="contenido-articulo">
                                        <p><b>{{ utensilio.nombre6 }}</b></p>
                                        <p>{{ utensilio.descripcion6|truncatewords:15 }}</p>
                                    </div>
                                </div>
                            </div>
                            {% if utensilio.imagen6 %}
                            <img src="{{ utensilio.imagen6.url }}" alt="{{ utensilio.nombre6 }}">
                            {% else %}
                            <img src="{% static 'core/img/Cucharas.jpg' %}" alt="{{ utensilio.nombre6 }}">
                            {% endif %}
                            <div class="contenido-articulo">
                                <p class="precio-destacado">${{ utensilio.precio6 }}</p>
                                <button class="btn-ver-detalles" onclick="mostrarDetalles('utensilio', {{ utensilio.id }}, '{{ utensilio.nombre6|escapejs }}', '{{ utensilio.descripcion6|escapejs }}', '{{ utensilio.precio6 }}', '{% if utensilio.imagen6 %}{{ utensilio.imagen6.url }}{% else %}{% static 'core/img/Cucharas.jpg' %}{% endif %}')">Ver Detalles y Comprar</button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="articulo">
                            <div class="contenido-articulo">
                                <p>No hay productos disponibles</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button><a href="{% url 'tapiceria' %}">Conocer más</a></button>
                </div>
            </div>
        </section>
    </section>
    <footer>
        <p>&copy; 2025 Tu Idea Hecha Realidad</p>
    </footer>
</div>

<!-- Modal de Detalles del Producto -->
<div id="productModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="cerrarModal()">&times;</span>
        <div class="modal-header">
            <h2 id="modalTitle">Detalles del Producto</h2>
        </div>
        <div class="modal-body">
            <img id="modalImage" class="modal-product-image" src="" alt="Producto">
            <div class="modal-product-info">
                <h3 id="modalProductName"></h3>
                <p id="modalProductDescription"></p>
                <p class="precio-destacado">Precio: $<span id="modalProductPrice"></span></p>
                
                <div class="quantity-selector">
                    <label for="quantity">Cantidad:</label>
                    <button onclick="cambiarCantidad(-1)">-</button>
                    <input type="number" id="quantity" value="1" min="1" max="99" readonly>
                    <button onclick="cambiarCantidad(1)">+</button>
                </div>
                
                <p><strong>Total: $<span id="totalPrice"></span></strong></p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-comprar" onclick="agregarAlCarrito()">Agregar al Carrito</button>
        </div>
    </div>
</div>

<script>
    let currentProduct = {};

    function mostrarDetalles(tipo, id, nombre, descripcion, precio, imagen) {
        currentProduct = {
            tipo: tipo,
            id: id,
            nombre: nombre,
            descripcion: descripcion,
            precio: parseFloat(precio),
            imagen: imagen
        };
        
        document.getElementById('modalProductName').textContent = nombre;
        document.getElementById('modalProductDescription').textContent = descripcion;
        document.getElementById('modalProductPrice').textContent = precio;
        document.getElementById('modalImage').src = imagen;
        document.getElementById('quantity').value = 1;
        actualizarTotal();
        
        document.getElementById('productModal').style.display = 'block';
    }
    
    function cerrarModal() {
        document.getElementById('productModal').style.display = 'none';
    }
    
    function cambiarCantidad(delta) {
        let input = document.getElementById('quantity');
        let newValue = parseInt(input.value) + delta;
        if (newValue >= 1 && newValue <= 99) {
            input.value = newValue;
            actualizarTotal();
        }
    }
    
    function actualizarTotal() {
        let cantidad = parseInt(document.getElementById('quantity').value);
        let total = currentProduct.precio * cantidad;
        document.getElementById('totalPrice').textContent = total.toFixed(2);
    }
    
    function agregarAlCarrito() {
        let cantidad = parseInt(document.getElementById('quantity').value);
        
        // Aquí se agregaría la lógica para agregar al carrito
        // Por ahora, redirigimos al carrito con la información del producto
        let params = new URLSearchParams({
            tipo: currentProduct.tipo,
            id: currentProduct.id,
            cantidad: cantidad
        });
        
        // Guardar en sessionStorage para el carrito
        let carrito = JSON.parse(sessionStorage.getItem('carrito') || '[]');
        
        // Verificar si el producto ya existe en el carrito
        let existente = carrito.find(item => item.tipo === currentProduct.tipo && item.id === currentProduct.id);
        
        if (existente) {
            existente.cantidad += cantidad;
        } else {
            carrito.push({
                tipo: currentProduct.tipo,
                id: currentProduct.id,
                nombre: currentProduct.nombre,
                precio: currentProduct.precio,
                cantidad: cantidad,
                imagen: currentProduct.imagen,
                descripcion: currentProduct.descripcion
            });
        }
        
        sessionStorage.setItem('carrito', JSON.stringify(carrito));
        
        alert('¡Producto agregado al carrito!');
        cerrarModal();
        
        // Preguntar si desea ir al carrito
        if (confirm('¿Desea ir al carrito ahora?')) {
            window.location.href = '{% url "carrito" %}';
        }
    }
    
    // Cerrar el modal si se hace clic fuera de él
    window.onclick = function(event) {
        let modal = document.getElementById('productModal');
        if (event.target == modal) {
            cerrarModal();
        }
    }

  function aplicarFiltros() {
        const categoria = document.getElementById('categoria').value;
        console.log('Aplicando filtros y redirigiendo...');
        console.log('Categoría seleccionada:', categoria);

        if (categoria) {
            const urlRedireccion = '/' + categoria + '/';
            
            console.log('Redirigiendo a:', urlRedireccion);
            window.location.href = urlRedireccion;
        } else {
            window.location.href = '/productos/'; 
        }
    }
</script>
</body>
</html>
